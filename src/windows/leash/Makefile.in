# makefile: Leash executable
#

#TODO Fix later:
NO_AFS=1

!ifndef NO_AFS
###AFS_BASE=
AFS_INCLUDES=-I$(AFS_BASE)\Include
AFS_LIB=$(AFS_BASE)\lib
AFS_LIBS=$(AFS_LIB)\afsauthent.lib
!else
AFS_INCLUDES=
AFS_LIBS=
!endif


#////$(OUTPRE)Krb4AddToDomainRealmList.obj \
#////	$(OUTPRE)Krb4AddToRealmHostList.obj \
#////	$(OUTPRE)Krb4DomainRealmMaintenance.obj \
#////	$(OUTPRE)Krb4EditDomainRealmList.obj \
#////	$(OUTPRE)Krb4EditRealmHostList.obj \
#////	$(OUTPRE)Krb4Properties.obj \
#////	$(OUTPRE)Krb4RealmHostMaintenance.obj \
	
OBJS=   \
	$(OUTPRE)CLeashDragListBox.obj \
	$(OUTPRE)Krb5Properties.obj \
	$(OUTPRE)KrbAddHostServer.obj \
	$(OUTPRE)KrbAddRealm.obj \
	$(OUTPRE)KrbConfigOptions.obj \
	$(OUTPRE)KrbDomainRealmMaintenance.obj \
	$(OUTPRE)KrbEditHostServer.obj \
	$(OUTPRE)KrbEditRealm.obj \
	$(OUTPRE)KrbProperties.obj \
	$(OUTPRE)KrbRealmHostMaintenance.obj \
	$(OUTPRE)Leash.obj \
	$(OUTPRE)LeashAboutBox.obj \
	$(OUTPRE)LeashDebugWindow.obj \
	$(OUTPRE)LeashDoc.obj \
	$(OUTPRE)LeashFileDialog.obj \
	$(OUTPRE)LeashFrame.obj \
	$(OUTPRE)LeashMessageBox.obj \
	$(OUTPRE)LeashProperties.obj \
	$(OUTPRE)LeashView.obj \
	$(OUTPRE)lglobals.obj \
	$(OUTPRE)MainFrm.obj \
	$(OUTPRE)StdAfx.obj \
	$(OUTPRE)AfsProperties.obj \
	$(OUTPRE)VSroutines.obj \
	$(OUTPRE)KrbMiscConfigOpt.obj

RESFILE = $(OUTPRE)Leash.res
XOBJS	= $(RESFILE)

##### Options
# Set NODEBUG if building release instead of debug
BUILDTOP=..\..

LOCALINCLUDES= -I$(BUILDTOP) -I$(BUILDTOP)\include -I$(BUILDTOP)\windows\include

##### RC Compiler
RFLAGS	= $(LOCALINCLUDES)
RCFLAGS	= $(RFLAGS) -D_WIN32 -DLEASH_APP


DEFINES = -DWINSOCK -DWIN32 -DWINDOWS -D_AFXDLL -DNO_KRB4
!ifdef NODEBUG
DEFINES = $(DEFINES)
!else
DEFINES = $(DEFINES) -DDBG
!endif

!ifdef NO_AFS
DEFINES = $(DEFINES) -DNO_AFS
!endif

##### Linker
LINK	= link
LIBS	= $(GLIB) $(CLIB) $(WLIB)
SYSLIBS	= kernel32.lib ws2_32.lib user32.lib gdi32.lib comdlg32.lib comctl32.lib
LFLAGS	= /nologo $(LOPTS)

all:: Makefile $(OUTPRE)leash32.exe

$(OUTPRE)leash32.exe: $(OBJS) $(XOBJS) $(LIBS)
	$(LINK) $(LFLAGS) /out:$@ $(OBJS) $(XOBJS) \
	  $(LIBS) $(SYSLIBS) $(KFWLIB) $(SCLIB)

$(RESFILE): ..\version.rc Leash.rc

clean:: 
	if exist $(OUTPRE)*.exe del $(OUTPRE)*.exe
	if exist $(OUTPRE)*.obj del $(OUTPRE)*.obj
	if exist $(OUTPRE)*.res del $(OUTPRE)*.res
	if exist $(OUTPRE)*.pdb del $(OUTPRE)*.pdb
	if exist *.err del *.err

